# {{ ansible_managed_header }}
# {{ ansible_managed }}

server {
    listen {{ backend_listen }};

    set $MAGE_RUN_CODE $store_code;
    set $MAGE_RUN_TYPE store;
    set $MAGE_MODE production;

    root {{ backend_webroot }};
    index index.php;
    autoindex off;
    charset off;

    port_in_redirect off;

    add_header X-Pool {{ backend_pool }} always;
    set $fastcgi_backend unix:/var/run/php-fpm/{{ backend_name }}.sock;

    access_log /var/log/nginx/{{ backend_name }}_backend-access.log main;
    error_log /var/log/nginx/{{ backend_name }}_backend-error.log warn;

    include /etc/nginx/default.d/settings.conf;
    include /etc/nginx/available.d/php-status.conf;
    include /etc/nginx/available.d/magento2.conf;
}
